## Input data from filebeats which is installed on the webserver
input { beats {
        port => 5000
                codec => plain { charset => "UTF-8" }
        type => "log"
}
}

## Add your filters / logstash plugins configuration here
filter {
        grok {
                match => { "message" => "%{YEAR:yr}-%{MONTHNUM:mo}-%{MONTHDAY:day} %{TIME:time},%{INT:mills} - %{WORD:user} - %{WORD:level} - %{IPORHOST:clientip} - - \[%{MONTHDAY:day1}/%{MONTH:mo1}/%{YEAR:yr1} %{TIME:time1}\] \"(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:httpversion})?|%{DATA:rawrequest})\" %{NUMBER:response}"}
        }
        mutate {
                add_field => { "ts" => "%{yr}-%{mo}-%{day}T%{time}.%{mills}Z" }
                remove_field => ["user", "day1", "mo1", "yr1", "time1", "yr", "mo", "day", "time", "mills"]
        }
        date {
        	 match => ["ts", "yyyy-MM-dd'T'HH:mm:ss'.'SSS'Z'"]
    		 target => "@timestamp"
  	}
}

output {
   stdout { codec => rubydebug }
  elasticsearch {
    user => "elastic"
    password => "changeme"
    hosts => ["http://54.184.97.231:9200"]
  }
}
